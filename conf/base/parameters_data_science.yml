outliers:
  features:
    target: c_yearly_margin_per_liter
  z_score_threshold: 10 # 3
  base_quantile:
    lower_quantile: 0
    upper_quantile: 0.975
  frequent_clients:
    min_perc_week_threshold: 0.7
    days_since_last_trx_threshold: 30
first_stage:
  cross_validation:
    cv_folds: 10
    scoring:
      rmse: neg_root_mean_squared_error
      mae: neg_mean_absolute_error
      r2: r2
      mape: neg_mean_absolute_percentage_error
  filter:
    threshold: 0.0 # 0.01 A mayor numero mas en Top Performers
    use_minimum_margin:
      enabled: False
      min_margin_threshold: 20
      min_volume_threshold: 1500000
  algorithms:
    # - lightgbm
    - catboost
  optimize_hyperparams: True
  features:
    target: c_yearly_margin_per_liter
    categorical:
    numerical:
      comma_columns:
        - fleet_size
        # - c_yearly_volumen
        - c_yearly_network_volumen
        - c_yearly_avg_volume_per_trx
        - region_diversity_index
        - c_weighted_competitive_index
      percent_columns:
        # - home_region_ratio
        - share_customer_region_13
        - share_customer_region_7
        - share_customer_region_3
        - share_customer_region_6
        - share_customer_region_16
        - share_customer_region_10
        - share_customer_region_15
        - share_customer_region_14
        - share_customer_region_8
        - share_customer_region_4
        - share_customer_region_9
        - share_customer_region_2
        - share_customer_region_5
        - share_customer_region_1
        - share_customer_region_11
        - share_customer_region_12
        - c_tct_yearly_perc_volume
  hyperparameters:
    metric: mae
    n_trials: 10
    n_splits: 10
    catboost:
      depth:
        type: int
        low: 10 #2
        high: 12 #6      # allow deeper trees
      learning_rate:
        type: float
        low: 0.1 # allow slower learning
        high: 0.3
      l2_leaf_reg:
        type: float
        low: 1 # avoid extremely low values
        high: 5 # stronger regularization allowed
      iterations:
        type: int
        low: 1000
        high: 1500
second_stage:
  cross_validation:
    cv_folds: 10
    scoring:
      rmse: neg_root_mean_squared_error
      mae: neg_mean_absolute_error
      r2: r2
      mape: neg_mean_absolute_percentage_error
  algorithms:
    # - lightgbm
    - catboost
  optimize_hyperparams: True
  features:
    target: c_yearly_margin_per_liter
    categorical:
      # - bin_fleet_size TODO: Data Leakage
      # - bin_volume
      # - cluster
    numerical:
      comma_columns:
        # - fleet_size
        # - c_yearly_volumen
        - c_yearly_network_volumen
        # - c_yearly_avg_volume_per_trx
        - region_diversity_index
        - c_weighted_competitive_index
      percent_columns:
        # - home_region_ratio
        - share_customer_region_13
        - share_customer_region_7
        - share_customer_region_3
        - share_customer_region_6
        - share_customer_region_16
        - share_customer_region_10
        - share_customer_region_15
        - share_customer_region_14
        - share_customer_region_8
        - share_customer_region_4
        - share_customer_region_9
        - share_customer_region_2
        - share_customer_region_5
        - share_customer_region_1
        - share_customer_region_11
        - share_customer_region_12
        - c_tct_yearly_perc_volume
  hyperparameters:
    metric: mae
    n_trials: 10
    n_splits: 10
    catboost:
      depth:
        type: int
        low: 4
        high: 8  # shallower trees
      learning_rate:
        type: float
        low: 0.01
        high: 0.05  # slower learning
      l2_leaf_reg:
        type: float
        low: 5
        high: 20  # stronger regularization
      iterations:
        type: int
        low: 500
        high: 1000  # let early stopping handle training length